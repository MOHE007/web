# 新闻快讯项目策划

本策划旨在明确当前产品的目标、架构与近期优化事项，使前端访问不再出现“API连接失败”，并确保“新闻可正常获取与展示”。

## 目标
- 前端站点可稳定连接到 API 网关（含跨域配置）。
- 新闻列表与分类接口稳定返回数据；支持导入与评分。
- 微服务端口统一：网关8000、新闻8001、解析8002、分类8003、清洗8004、采集8005。

## 架构与路由
- API 网关负责统一对外：
  - `/news`：新闻列表与CRUD代理。
  - `/news/import/google_news` → `news-service:/import/google_news`
  - `/news/import/newsminimalist` → `news-service:/import/newsminimalist`
  - `/news/top` → `news-service:/top`
  - `/news/rescore` → `news-service:/rescore`
  - `/news/score/{id}` → `news-service:/score/{id}`
- CORS 默认允许 `https://wakolanews.online` 与 `https://api.wakolanews.online`，生产环境可通过 `GATEWAY_ALLOW_ORIGINS` 精确控制。

## 数据流（/process-news）
1. `collector-service:/collect` 抓取原始HTML。
2. `parser-service:/parse` 解析为结构化 `NewsData`。
3. `cleaner-service:/clean` 清洗与去重，输出 `cleaned_item`。
4. `news-service:/news (POST)` 入库（避免重复）。

## 近期优化与已完成事项
- [已完成] 新增 `news-service:/news (POST)` 创建接口。
- [已完成] 网关新增/修复导入与评分相关代理（import/top/rescore/score）。
- [已完成] 网关默认CORS加入生产域名。
- [已完成] 采集服务端口统一为8005，网关配置同步。
- [已完成] 新闻服务健康检查 `/health`。

## 前端接入要点
- `frontend/index.html` 可通过 `window.__API_BASE__` 指向生产网关，如：`https://api.wakolanews.online`。
- 若出现 CORS 问题，设置网关环境变量 `GATEWAY_ALLOW_ORIGINS`：
  - 示例：`https://wakolanews.online,https://api.wakolanews.online`。

## 验证清单
- 访问网关 `GET /health`，各服务 `healthy` 或 `degraded`（至少新闻服务 `healthy`）。
- 访问 `GET /news` 返回内置样例与导入数据。
- 访问 `GET /news/import/google_news?lang=zh&limit=5` 返回导入预览；随后 `GET /news` 可见新增数据。

## 后续工作
- 分类服务与清洗服务补充健康与错误路径返回，帮助网关健康聚合更准确。
- 导入时分类策略与语言权重再优化，提升前端展示质量。

## 1. 技术架构设计

### 1.1 后端架构
- **微服务拆分**:
  - `collector-service`: 数据采集服务 (已实现)
  - `parser-service`: 数据解析服务 (已实现)
  - `cleaner-service`: 数据清洗服务 (已实现)
  - `scheduler-service`: 任务调度服务 (已实现)
  - `api-gateway`: API 网关 (已实现)
  - `news-service`: 新闻服务 (已实现)
  - `category-service`: 分类服务 (已实现)
- **技术选型**:
  - **语言**: Python
  - **框架**: FastAPI
  - **数据库**:
    - **新闻数据**: 内存 (后续可升级为 PostgreSQL/SQLite)
    - **去重缓存**: 内存 (后续可升级为 Redis)
    - **全文搜索**: (后续可集成 Meilisearch/Elasticsearch)

### 1.2 前端架构
- **技术选型**:
  - **框架**: 原生 JavaScript
  - **语言**: JavaScript
  - **UI 库**: 无

## 2. 爬虫规则库

- **规则格式** (feeds.yml):
  - `name`: 新闻源名称
  - `url`: 新闻源 URL
  - `type`: 内容类型 (HTML/XML)
  - `frequency_minutes`: 爬取频率（分钟）
  - `category`: 所属分类

- **已配置新闻源**:
  - 人民网
  - 新华网
  - 腾讯网
  - 网易网
  - BBC News
  - 纽约时报
  - 路透社
  - 美联社
  - 半岛电视台
  - 德国之声
  - France 24
  - 中国日报

## 3. UI原型图

- **UI/UX 设计**:
  - 灵感来源: OpenAI / Apple
  - 风格: 简约、现代、注重可读性
  - 布局: 简化的导航，紧凑的新闻卡片
  - 响应式: 适配桌面和移动设备

## 4. 开发日志

- **YYYY-MM-DD**:
  - **完成**:
    - 创建了 `feeds.yml` 配置文件，包含12个新闻源。
    - 更新了 `api-gateway` 的 `SERVICE_URLS`。
    - 为 `collector-service`、`parser-service` 和 `cleaner-service` 添加了Uvicorn启动配置。
    - 创建了 `scheduler-service` 用于任务调度。
  - **下一步**:
    - 停止并重启所有后端服务。
    - 启动新的 `scheduler-service`。
    - 验证端到端功能。

## 5. 功能迭代路线图

- **v1.0 (核心功能)**:
  - [x] 数据采集与存储 (内存)
  - [x] 基本分类体系
  - [x] 基础UI展示
- **v1.1 (优化与扩展)**:
  - [ ] UI/UX 重新设计 (进行中)
  - [ ] 迁移到持久化存储 (PostgreSQL/SQLite, Redis)
  - [ ] 实现全文搜索
  - [ ] 增强数据清洗 (摘要、去重、事实核查)
- **v1.2 (质量与监控)**:
  - [ ] 结构化日志
  - [ ] 单元测试
  - [ ] 自动化部署与监控